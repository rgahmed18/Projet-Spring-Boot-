spring.application.name=api-gateway
server.port=8080

# --- EUREKA CONFIGURATION ---
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/

# --- ROUTES CONFIGURATION ---

# Route 0 : Documentation Swagger Commande
spring.cloud.gateway.server.webflux.routes[0].id=route-commandes-doc
spring.cloud.gateway.server.webflux.routes[0].uri=lb://commande-service
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/commandes/v3/api-docs

# StripPrefix pour envoyer /v3/api-docs au microservice
spring.cloud.gateway.server.webflux.routes[0].filters[0].name=StripPrefix
spring.cloud.gateway.server.webflux.routes[0].filters[0].args.parts=1

# Route 1 : API Commande (C'est ici qu'on utilise le nom court 'CircuitBreaker')
spring.cloud.gateway.server.webflux.routes[1].id=route-commandes
spring.cloud.gateway.server.webflux.routes[1].uri=lb://commande-service
spring.cloud.gateway.server.webflux.routes[1].predicates[0]=Path=/commandes/**
# ? CORRECTION : Utilisation du nom 'CircuitBreaker' reconnu par le starter
spring.cloud.gateway.server.webflux.routes[1].filters[0].name=CircuitBreaker
spring.cloud.gateway.server.webflux.routes[1].filters[0].args.name=commandesCB
spring.cloud.gateway.server.webflux.routes[1].filters[0].args.fallbackUri=forward:/fallback/Commandes
# Filtre StripPrefix pour envoyer la requÃÂªte propre au microservice
spring.cloud.gateway.server.webflux.routes[1].filters[1].name=StripPrefix
spring.cloud.gateway.server.webflux.routes[1].filters[1].args.parts=1

# Route 2 : Documentation Swagger Produit
spring.cloud.gateway.server.webflux.routes[2].id=route-produits-doc
spring.cloud.gateway.server.webflux.routes[2].uri=lb://produit-service
spring.cloud.gateway.server.webflux.routes[2].predicates[0]=Path=/produits/v3/api-docs

# StripPrefix pour envoyer /v3/api-docs au microservice
spring.cloud.gateway.server.webflux.routes[2].filters[0].name=StripPrefix
spring.cloud.gateway.server.webflux.routes[2].filters[0].args.parts=1

# Route 3 : API Produit
spring.cloud.gateway.server.webflux.routes[3].id=route-produits
spring.cloud.gateway.server.webflux.routes[3].uri=lb://produit-service
spring.cloud.gateway.server.webflux.routes[3].predicates[0]=Path=/produits/**
spring.cloud.gateway.server.webflux.routes[3].filters[0].name=StripPrefix
spring.cloud.gateway.server.webflux.routes[3].filters[0].args.parts=1

spring.cloud.gateway.server.webflux.routes[4].id=route-api-products
spring.cloud.gateway.server.webflux.routes[4].uri=lb://produit-service
spring.cloud.gateway.server.webflux.routes[4].predicates[0]=Path=/api/products,/api/products/**,/api/produits,/api/produits/**

spring.cloud.gateway.server.webflux.routes[5].id=route-api-orders
spring.cloud.gateway.server.webflux.routes[5].uri=lb://commande-service
spring.cloud.gateway.server.webflux.routes[5].predicates[0]=Path=/api/orders,/api/orders/**,/api/commandes,/api/commandes/**

# CircuitBreaker + fallback pour les routes API /api/orders et /api/commandes
spring.cloud.gateway.server.webflux.routes[5].filters[0].name=CircuitBreaker
spring.cloud.gateway.server.webflux.routes[5].filters[0].args.name=commandesCB
spring.cloud.gateway.server.webflux.routes[5].filters[0].args.fallbackUri=forward:/fallback/Commandes

# DÃÂ©duplication des headers CORS (Gateway + microservices peuvent tous deux les ajouter)
spring.cloud.gateway.server.webflux.default-filters[0]=DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials, RETAIN_FIRST

# --- CONFIGURATION CORS (Syntaxe standard Spring Boot 3) ---
spring.cloud.gateway.server.webflux.globalcors.add-to-simple-url-handler-mapping=true
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allowed-origins=http://localhost:3000
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allowed-headers=*
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allow-credentials=true

# --- RESILIENCE & ACTUATOR ---
management.endpoints.web.exposure.include=*
# ? CORRECTION : kebab-case pour la durÃÂ©e du timeout
resilience4j.timelimiter.instances.commandesCB.timeout-duration=3s

# --- SWAGGER UI ---
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.api-docs.enabled=true
springdoc.swagger-ui.urls[0].name=commande-service
springdoc.swagger-ui.urls[0].url=/commandes/v3/api-docs
springdoc.swagger-ui.urls[1].name=produit-service
springdoc.swagger-ui.urls[1].url=/produits/v3/api-docs
