server.port=8083
spring.application.name=commande-service

# Importation de la configuration depuis le Config Server
spring.config.import=optional:configserver:http://localhost:8888

# Optionnel : si vous voulez que le service démarre même si le Config Server est éteint
spring.cloud.config.fail-fast=false

# Eureka Configuration
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/

# --- ROUTES CONFIGURATION (Mise à jour pour Spring Boot 3.5+) ---

# 0. Route Commandes Swagger Doc
spring.cloud.gateway.server.webflux.routes[0].id=route-commandes-doc
spring.cloud.gateway.server.webflux.routes[0].uri=lb://commande-service
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/commandes/v3/api-docs

# 1. Route Commandes API (Circuit Breaker + StripPrefix)
spring.cloud.gateway.server.webflux.routes[1].id=route-commandes
spring.cloud.gateway.server.webflux.routes[1].uri=lb://commande-service
spring.cloud.gateway.server.webflux.routes[1].predicates[0]=Path=/commandes/**
spring.cloud.gateway.server.webflux.routes[1].filters[0].name=Resilience4jCircuitBreaker
spring.cloud.gateway.server.webflux.routes[1].filters[0].args.name=commandesCB
spring.cloud.gateway.server.webflux.routes[1].filters[0].args.fallbackUri=forward:/fallback
spring.cloud.gateway.server.webflux.routes[1].filters[1].name=StripPrefix
spring.cloud.gateway.server.webflux.routes[1].filters[1].args.parts=1

# 2. Route Produit Swagger Doc
spring.cloud.gateway.server.webflux.routes[2].id=route-produits-doc
spring.cloud.gateway.server.webflux.routes[2].uri=lb://produit-service
spring.cloud.gateway.server.webflux.routes[2].predicates[0]=Path=/produits/v3/api-docs

# 3. Route Produit API (StripPrefix)
spring.cloud.gateway.server.webflux.routes[3].id=route-produits
spring.cloud.gateway.server.webflux.routes[3].uri=lb://produit-service
spring.cloud.gateway.server.webflux.routes[3].predicates[0]=Path=/produits/**
spring.cloud.gateway.server.webflux.routes[3].filters[0].name=StripPrefix
spring.cloud.gateway.server.webflux.routes[3].filters[0].args.parts=1

# --- CORS CONFIGURATION (Mise à jour pour React) ---
spring.cloud.gateway.server.webflux.globalcors.add-to-simple-url-handler-mapping=true
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allowedorigins=http://localhost:3000
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allowedmethods=GET,POST,PUT,DELETE
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allowedheaders=*
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allowcredentials=true

# --- ACTUATOR & RESILIENCE ---
management.endpoints.web.exposure.include=*
resilience4j.timelimiter.instances.commandesCB.timeoutDuration=3s

# --- SWAGGER UI ---
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.api-docs.enabled=true
springdoc.swagger-ui.urls[0].name=commande-service
springdoc.swagger-ui.urls[0].url=/commandes/v3/api-docs
springdoc.swagger-ui.urls[1].name=produit-service
springdoc.swagger-ui.urls[1].url=/produits/v3/api-docs